<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>الإدارة — Super Literie</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  body{margin:0;font-family:"Cairo",sans-serif;background:#f5f5f5;color:#111}
  .login,.panel{max-width:800px;margin:40px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 5px 20px rgba(0,0,0,0.1)}
  h1,h2{color:#174b74}
  input,textarea,select{width:100%;padding:10px;margin:6px 0;border:1px solid #ddd;border-radius:8px;font-family:"Cairo"}
  button{background:#174b74;color:#fff;padding:10px 16px;border:0;border-radius:8px;cursor:pointer;font-weight:700}
  .product{padding:10px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center}
  .hidden{display:none}
  .row{display:flex;gap:10px}
  .row input{flex:1}
</style>
</head>
<body>

<div class="login" id="loginBox">
  <h1>تسجيل الدخول</h1>
  <input type="password" id="adminPass" placeholder="كلمة السر">
  <button onclick="checkPass()">دخول</button>
</div>

<div class="panel hidden" id="adminPanel">
  <h1>لوحة التحكم</h1>

  <h2>إعدادات المتجر</h2>
  <label>خلفية الصفحة الرئيسية</label>
  <input type="file" id="bgFile">
  <label>شعار المتجر (لوغو)</label>
  <input type="file" id="logoFile">
  <button onclick="saveSettings()">💾 حفظ الإعدادات</button>

  <h2>إضافة/تعديل منتج</h2>
  <input id="pTitle" placeholder="اسم المنتج">
  <input id="pPrice" placeholder="السعر">
  <textarea id="pDesc" placeholder="الوصف"></textarea>
  <label>صور المنتج</label>
  <input type="file" id="pImgs" multiple>
  
  <label>المقاسات (اختياري - افصل بينها بفاصلة)</label>
  <input id="pSizes" placeholder="مثال: S,M,L,XL">
  
  <label>الألوان (اختياري - افصل بينها بفاصلة)</label>
  <input id="pColors" placeholder="مثال: أحمر,أزرق,أخضر">
  
  <button onclick="addProduct()">➕ إضافة المنتج</button>

  <h2>قائمة المنتجات</h2>
  <div id="productList"></div>
</div>

<script type="module">
  // ===== Firebase =====
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAj8Dp9Rp98knthETTEBMx22KwICPy5x-8",
    authDomain: "super-literiee.firebaseapp.com",
    projectId: "super-literiee",
    storageBucket: "super-literiee.appspot.com",
    messagingSenderId: "829189351259",
    appId: "1:829189351259:web:0426969718d46132c19c7e",
    measurementId: "G-0KBQFEK6KH"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ===== Cloudinary Config =====
  const CLOUD_NAME = "dcilkalts";  
  const UPLOAD_PRESET = "unsingned_preset";  

  // ===== كلمة السر =====
  const ADMIN_PASSWORD = "123456"; // بدّلها بكلمة السر لي تحبها

  window.checkPass = function(){
    const val = document.getElementById("adminPass").value;
    if(val === ADMIN_PASSWORD){
      document.getElementById("loginBox").classList.add("hidden");
      document.getElementById("adminPanel").classList.remove("hidden");
      loadProducts();
    } else {
      alert("❌ كلمة السر خاطئة");
    }
  }

  // ===== رفع ملف لصورة على Cloudinary =====
  async function uploadFile(file) {
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", UPLOAD_PRESET);

    const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
      method: "POST",
      body: formData
    });

    const data = await res.json();
    return data.secure_url;
  }

  // ===== حفظ الإعدادات =====
  window.saveSettings = async function(){
    let bgUrl="", logoUrl="";
    const bgFile = document.getElementById("bgFile").files[0];
    const logoFile = document.getElementById("logoFile").files[0];
    if(bgFile) bgUrl = await uploadFile(bgFile);
    if(logoFile) logoUrl = await uploadFile(logoFile);

    await setDoc(doc(db,"settings","main"), {background:bgUrl,logo:logoUrl});
    alert("✅ تم حفظ الإعدادات");
  }

  // ===== إضافة منتج =====
  window.addProduct = async function(){
    const title = document.getElementById("pTitle").value;
    const price = Number(document.getElementById("pPrice").value);
    const desc = document.getElementById("pDesc").value;
    const sizes = document.getElementById("pSizes").value.split(",").map(s=>s.trim()).filter(Boolean);
    const colors = document.getElementById("pColors").value.split(",").map(c=>c.trim()).filter(Boolean);

    let imgs=[];
    const files = document.getElementById("pImgs").files;
    for(let f of files){
      const url = await uploadFile(f);
      imgs.push(url);
    }

    await addDoc(collection(db,"products"), {title,price,desc,img:imgs,sizes,colors});
    alert("✅ تم إضافة المنتج");
    loadProducts();
  }

  // ===== تحميل المنتجات =====
  async function loadProducts(){
    const snap = await getDocs(collection(db,"products"));
    let html="";
    snap.forEach(d=>{
      const p = d.data();
      html+=`<div class="product">
        <div>${p.title} - ${p.price} دج</div>
        <button onclick="deleteProduct('${d.id}')">🗑️ حذف</button>
      </div>`;
    });
    document.getElementById("productList").innerHTML = html;
  }

  // ===== حذف منتج =====
  window.deleteProduct = async function(id){
    await deleteDoc(doc(db,"products",id));
    alert("🗑️ تم الحذف");
    loadProducts();
  }
</script>

</body>
</html>